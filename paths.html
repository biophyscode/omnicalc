

<!doctype html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Raw Data &#8212; OMNICALC Documentation</title>
    
    <link rel="stylesheet" href="_static/bizstyle.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/bizstyle.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <!--[if lt IE 9]>
    <script type="text/javascript" src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">OMNI docs</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/omnicalc.png" alt="Logo"/>
            </a></p>
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Raw Data</a><ul>
<li><a class="reference internal" href="#incoming-data">Incoming data</a><ul>
<li><a class="reference internal" href="#data-from-automacs">Data from AUTOMACS</a></li>
<li><a class="reference internal" href="#data-from-elsewhere">Data from elsewhere</a></li>
</ul>
</li>
<li><a class="reference internal" href="#what-you-get">What you get</a></li>
<li><a class="reference internal" href="#setting-the-paths">Setting the paths</a><ul>
<li><a class="reference internal" href="#necessary-paths">Necessary paths</a></li>
<li><a class="reference internal" href="#new-data-paths">New data paths</a></li>
<li><a class="reference internal" href="#further-customization">Further customization</a></li>
<li><a class="reference internal" href="#naming-new-slices">Naming new slices</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/paths.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="raw-data">
<span id="sec-paths"></span><h1>Raw Data<a class="headerlink" href="#raw-data" title="Permalink to this headline">¶</a></h1>
<p>Omnicalc is designed to perform what most people refer to as “post-processing” for biophysics simulations, and in particular, molecular dynamcis data generated by <a class="reference external" href="http://www.gromacs.org/">GROMACS</a>. It has been specifically designed to work with the <a class="reference external" href="http://github.com/bradleyrp/automacs">Automacs</a> codes which generate large batches of GROMACS simulations, however it is designed to accept any GROMACS simulation data as long as it is organized according to the rules laid out below.</p>
<div class="section" id="incoming-data">
<h2>Incoming data<a class="headerlink" href="#incoming-data" title="Permalink to this headline">¶</a></h2>
<p>Instructions for importing your data must be written to a file called <code class="docutils literal"><span class="pre">paths.yaml</span></code>. The <a class="reference internal" href="#sec-path-setting"><span class="std std-ref">paths</span></a> section below will tell you exactly how to write this file. In this part, we will first describe how to organize your data so that omnicalc can identify it.</p>
<div class="section" id="data-from-automacs">
<h3>Data from AUTOMACS<a class="headerlink" href="#data-from-automacs" title="Permalink to this headline">¶</a></h3>
<p>Simulations created with automacs follow a consistent directory structure. Each simulation has a root folder which contains the automacs code, along with several sub-folders, each of which correspond to a discrete simulation “step”. Each step can have many parts, but the steps are designed to be the coherent unit of analysis. Complicated simulations may have a few steps, but most of the relevant simulation data are contained in a production run in the final step. See the documentation accompanying automacs for more details on why we organize the data this way.</p>
</div>
<div class="section" id="data-from-elsewhere">
<h3>Data from elsewhere<a class="headerlink" href="#data-from-elsewhere" title="Permalink to this headline">¶</a></h3>
<p>Users who have already generated large simulation data sets, or choose to use other methods to generate their data can prepare the data for use by omnicalc by mimicking its directory structure. The rule of thumb is that omnicalc must be able to find the files using a regular expression, using integers for any necessary ordering. As per the GROMACS custom and the automacs specification, we prefer to have the simulations organized into groups of trajectory files named e.g. <code class="docutils literal"><span class="pre">md.part0001.xtc</span></code> which can easily be detected and ordered by a regular expression (“<code class="docutils literal"><span class="pre">^md\.part([0-9]{4})\.xtc$</span></code>”).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">We would never encourage users to rename any files in a primary data set. If your files are not compatible with omnicalc, we suggest that you write a short program that uses symbolic links to name them in a systematic way.</p>
</div>
<p>While the naming scheme is relatively open-ended, the directory constraints are not. Users must have one folder per simulation, and the target data must be contained in a <em>sub</em>-folder of this.</p>
</div>
</div>
<div class="section" id="what-you-get">
<span id="sec-path-setting"></span><h2>What you get<a class="headerlink" href="#what-you-get" title="Permalink to this headline">¶</a></h2>
<p>Omnicalc produces three tangible types of data for you. First, it “slices” GROMACS trajectories into more manageable parts, isolating only the system components that you are interested in. This is particularly useful when you wish to load an entire simulation at a particular sampling rate into memory. If you only wish to analyze a single component in a large simulation, this data-reduction step can make it possible to load the entire trajectory into memory, which can often dramatically speed-up your analysis and visualization.</p>
<p>Second, omnicalc can perform detailed mathematical operations on your data using <a class="reference external" href="http://docs.scipy.org/doc/">numpy and scipy</a> libraries which can be saved to a portable binary format using the <a class="reference external" href="http://www.h5py.org/">HDF5</a> in Python. Calculation steps can be linked together in an arbitrary sequence to make the calculation efficient and modular.</p>
<p>Lastly, we have included a number of standardized plotting and animation routines that use <a class="reference external" href="http://matplotlib.org/">matplotlib</a> and <a class="reference external" href="http://www.ks.uiuc.edu/Research/vmd/">VMD</a> to create elegant images of the resulting data or trajectories.</p>
<p>We group the simulation slices and the postprocessing binaries in a single output directory and reserve a separate directory for plots. The paths to these data are specified in <code class="docutils literal"><span class="pre">paths.yaml</span></code> described next.</p>
</div>
<div class="section" id="setting-the-paths">
<h2>Setting the paths<a class="headerlink" href="#setting-the-paths" title="Permalink to this headline">¶</a></h2>
<p>As long as your data are correctly organized and mounted on your machine, you can set the paths by first running <code class="docutils literal"><span class="pre">make</span> <span class="pre">default_paths</span></code> in the omnicalc root directory. This creates a default <code class="docutils literal"><span class="pre">paths.yaml</span></code> file for you to edit. We have reproduced the essential features below. In the remainder of this section we will fully specify the omnicalc path scheme. For a quick start, read the comments in the default <code class="docutils literal"><span class="pre">paths.yaml</span></code> file.</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">post_data_spot</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">post</span>
<span class="l l-Scalar l-Scalar-Plain">post_plot_spot</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">plot</span>
<span class="l l-Scalar l-Scalar-Plain">workspace_spot</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">workspace</span>
<span class="l l-Scalar l-Scalar-Plain">timekeeper</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="l l-Scalar l-Scalar-Plain">spots</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">sims</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">namer</span><span class="p p-Indicator">:</span> <span class="s">&quot;lambda</span><span class="nv"> </span><span class="s">spot,top</span><span class="nv"> </span><span class="s">:</span><span class="nv"> </span><span class="s">&#39;v&#39;+re.findall(&#39;simulation-v([0-9]+)&#39;,top)[0]&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">route_to_data</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">PARENT_DIRECTORY_FOR_MY_DATA</span>
    <span class="l l-Scalar l-Scalar-Plain">spot_directory</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">DATA_DIRECTORY_IN_ROUTE_TO_DATA</span>
    <span class="l l-Scalar l-Scalar-Plain">regexes</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">top</span><span class="p p-Indicator">:</span> <span class="s">&#39;(simulation-v[0-9]+)&#39;</span>
      <span class="l l-Scalar l-Scalar-Plain">step</span><span class="p p-Indicator">:</span> <span class="s">&#39;([stuv])([0-9]+)-([^\/]+)&#39;</span>
      <span class="l l-Scalar l-Scalar-Plain">part</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">xtc</span><span class="p p-Indicator">:</span> <span class="s">&#39;md\.part([0-9]{4})\.xtc&#39;</span>
        <span class="l l-Scalar l-Scalar-Plain">trr</span><span class="p p-Indicator">:</span> <span class="s">&#39;md\.part([0-9]{4})\.trr&#39;</span>
        <span class="l l-Scalar l-Scalar-Plain">edr</span><span class="p p-Indicator">:</span> <span class="s">&#39;md\.part([0-9]{4})\.edr&#39;</span>
        <span class="l l-Scalar l-Scalar-Plain">tpr</span><span class="p p-Indicator">:</span> <span class="s">&#39;md\.part([0-9]{4})\.tpr&#39;</span>
        <span class="l l-Scalar l-Scalar-Plain">structure</span><span class="p p-Indicator">:</span> <span class="s">&#39;(system|system-input|structure)\.(gro|pdb)&#39;</span>
</pre></div>
</div>
<div class="section" id="necessary-paths">
<h3>Necessary paths<a class="headerlink" href="#necessary-paths" title="Permalink to this headline">¶</a></h3>
<p>Users must replace any capitalized text in the default <code class="docutils literal"><span class="pre">paths.yaml</span></code> file. The first path you must specify is the <code class="docutils literal"><span class="pre">route_to_data</span></code> variable, which sets the root directory for your incoming dataset. It is best to use this variable to set the system path for a data-specific harddrive. It’s easy to change this later if you move your data to a new system. The remainder of the path to your data is stored in <code class="docutils literal"><span class="pre">spot_directory</span></code>. It is best to set this directory with a more permanent name to avoid confusion. The <code class="docutils literal"><span class="pre">route_to_data</span></code> directory is entirely flexible, and can be changed whenever you move or re-mount the harddrive.</p>
<p>The <code class="docutils literal"><span class="pre">spot_directory</span></code> variable should point from th <code class="docutils literal"><span class="pre">route_to_data</span></code> to a single, specific dataset. Omnicalc is designed to use <em>multiple</em> parallel datasets at the same time. We refer to the paths of these datasets as “spots”, each of which is defined by a separate sub-dictionary underneath <code class="docutils literal"><span class="pre">spots</span></code> in the <code class="docutils literal"><span class="pre">paths.yaml</span></code> file. The name of the subdirectory for each spot (e.g. <code class="docutils literal"><span class="pre">sims</span></code> in the example above) is typically hidden from the user, and is only used by omnicalc to keep track of the parallel datasets.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">There is only one limitation (but many potential flaws) that come with the total flexibility described above. Multiple spots cannot contain sub-folders with the same name otherwise omnicalc won’t know which one to use later, when it looks them up. As long as you follow this rule, the paths are entirely arbitrary. You can have multiple spots (and hence distinct datasets) within a single directory as long as you can distinguish them by regular expressions.</p>
</div>
<p>Using multiple spots it useful if you generate your data in separate batches but wish to analyze them together. Organizing large datasets into these “spots” gives you the first opportunity to divde your data into smaller groups. There will be many more opportunities for organizing the data <em>within</em> the omnicalc framework when you begin to write analysis routines. The restrictions described here only tell omnicalc how to read your data.</p>
</div>
<div class="section" id="new-data-paths">
<h3>New data paths<a class="headerlink" href="#new-data-paths" title="Permalink to this headline">¶</a></h3>
<p>All new data generated by omnicalc will default to the <code class="docutils literal"><span class="pre">post</span></code> and <code class="docutils literal"><span class="pre">plot</span></code> directories which will be created inside the omnicalc root folder. Users who wish to store post-processing data or plots elsewhere can either set them in <code class="docutils literal"><span class="pre">paths.yaml</span></code> or use symbolic links to new directories. It is important to note that the <code class="docutils literal"><span class="pre">post</span></code> folder will become large because it will contain slices of the simulation trajectories (as well as any calculated data, although those tend to be much smaller). Omnicalc will also write its current state to a <code class="docutils literal"><span class="pre">workspace</span></code> file which is explained elsewhere.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">link to the workspace description</p>
</div>
</div>
<div class="section" id="further-customization">
<h3>Further customization<a class="headerlink" href="#further-customization" title="Permalink to this headline">¶</a></h3>
<p>The default paths are set to import data from automacs but can be modified to recognize many different naming schemes. The <code class="docutils literal"><span class="pre">regexes</span></code> subdictionary for each spot will tell omnicalc how to find your data. We will describe this dictionary in detail because it has consequences for naming and distinguishing your simulations.</p>
<p>In all subsequent analysis, your simulations must be identified by their name, specifically the name of the folder that contains the simulation (recall that one of the only hard contraints is that the GROMACS trajectories must be in a <em>sub</em>-folder). In the default <code class="docutils literal"><span class="pre">paths.yaml</span></code> file, the simulation names are specified by <code class="docutils literal"><span class="pre">top</span></code> insides the <code class="docutils literal"><span class="pre">regexes</span></code> dictionary. In this case they use the automacs default in which all simulations are named with numbers e.g. <code class="docutils literal"><span class="pre">simulation-v123</span></code>.</p>
<p>It is often clusmy to refer to simulations this way. Omnicalc allows you to group them with colloquial names using <code class="docutils literal"><span class="pre">collections</span></code> during the analysis phase. You can use an arbitrary regular expression (e.g. <code class="docutils literal"><span class="pre">&quot;(\w+)&quot;</span></code>) if you wish to use entirely unconstrained names. Make sure to use parentheses to extract a group from the regex. The contents of the only group in this regex will be the formal “name” of your simulation used throughout the analysis.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">link to collections above</p>
</div>
<p>The folders found inside of the <code class="docutils literal"><span class="pre">spot_directory</span></code> that match the <code class="docutils literal"><span class="pre">top</span></code> regex will constitute the “steps” of the simulation. Omnicalc tracks all trajectory files internally using a tuple containing the simulation name (the top directory), the step folder (the sub-directory), and the file name. The step names can be arbitrary, but it is often helpful to order them. This ordering can be useful in the event that you reset the simulation time using GROMACS. Most users wish to collect the most recent portions of the trajectory because they are typically the most relevant, especially if you use a complicated simulation construction procedure.</p>
<p>The default <code class="docutils literal"><span class="pre">paths.yaml</span></code> specifies that step folders should be named with a letter and number followed by a word. This follows the automacs convention in which simulation steps are named e.g. <code class="docutils literal"><span class="pre">s02-bilayer-protein.</span></code>. The step regex can use an arbitrary number of groups which may be useful to the user later, if they wish to sort the steps based on those groups. This could be useful if your simulation steps consist of replicates (however it’s important to note that this can also be achieved by using spots or collections).</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">check (1) whether the regex groups are used for step-directory ordering and (2) whether that actually matters and (3) when and why</p>
</div>
<p>The final regex is the “part” used to detect files that are part of a simulation trajectory. The example above uses the GROMACS convention in which files are named e.g. <code class="docutils literal"><span class="pre">md.part0001.xtc</span></code> or <code class="docutils literal"><span class="pre">md.part0001.edr</span></code> in sequence. However, the only requirement is that your files have numbers which can be used to sort their constituent parts into the proper order.</p>
<p>You may notice that we have separate regex expressions to identify the common GROMACS file types, namely <code class="docutils literal"><span class="pre">xtc</span></code>, <code class="docutils literal"><span class="pre">trr</span></code> for trajectories, <code class="docutils literal"><span class="pre">edr</span></code> for energy files, <code class="docutils literal"><span class="pre">structure</span></code> for coordinate files, and <code class="docutils literal"><span class="pre">tpr</span></code> for binary input files. Each of these is used by omnicalc. In particular, the energy files provide a fast way to identify the simulation clock for each trajectory, and the input files are essential for unwrapping periodic boundary conditions (or any calculation that requires the topology of your molecules).</p>
</div>
<div class="section" id="naming-new-slices">
<span id="sec-slice-names"></span><h3>Naming new slices<a class="headerlink" href="#naming-new-slices" title="Permalink to this headline">¶</a></h3>
<p>In the paragraphs above, we have described how omnicalc reads your dataset. One final component of <code class="docutils literal"><span class="pre">paths.yaml</span></code> specifies the format by which omnicalc will write “slices” of your simulation. Since these slices allow for an arbirary sampling frequency and subsets of the chemical components of the simulation, the slicing functions can be incredibly useful for isolating a particular portion of your data for further analysis. Some users may wish to use omnicalc for this function alone (without the awesome calculation features described next).</p>
<p>The <code class="docutils literal"><span class="pre">namer</span></code> tells omnicalc how to create file names for the trajectory slices. Every time it slices a simulation, it creates a structure file and a trajectory file (the latter can be a full-precision <code class="docutils literal"><span class="pre">trr</span></code> or a compressed <code class="docutils literal"><span class="pre">xtc</span></code> file). The <code class="docutils literal"><span class="pre">namer</span></code> must be a pythonic lambda function that takes two arguments: the <code class="docutils literal"><span class="pre">spot</span></code> and the <code class="docutils literal"><span class="pre">top</span></code> and returns a string. The string will be prefixed to all slice files, which will also be suffixed with the time range for the slice and the contents. For example, if you use the default naming scheme, you might produce a file called <code class="docutils literal"><span class="pre">v531.100000-200000-1000.protein.xtc</span></code> which would contain a slice from <code class="docutils literal"><span class="pre">100-200ns</span></code> of a simulation named <code class="docutils literal"><span class="pre">simulation-v531</span></code> with a group called “protein”. We’ll describe the groups later.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">link to groups</p>
</div>
<p>Even though the <code class="docutils literal"><span class="pre">namer</span></code> function must accept the spot name (the name of its parent dictionary), you do not have to use the spot in the string that it returns. You must only ensure that incoming simulation names (given by <code class="docutils literal"><span class="pre">top</span></code>) will write unique strings to ensure that simulations coming from different spots do not overwrite others in the <code class="docutils literal"><span class="pre">post</span></code> directory. Since we require that no simulation names are repeated across spots (otherwise an error will occur), the <code class="docutils literal"><span class="pre">namer</span></code> must only retain the uniqueness of the <code class="docutils literal"><span class="pre">top</span></code> (simulation name). This is a best practice, so that you can identify your simulation slices.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">OMNI docs</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    </div>
  </body>
</html>